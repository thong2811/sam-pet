<?php
/**
 * @var Laminas\View\Renderer\PhpRenderer $this
 */
?>
<?php
$id = $this->reportData['id'] ?? '';
$date = $this->reportData['date'] ?? '';
$revenue = !empty($this->reportData['revenue']) ? $this->reportData['revenue'] : 0;
$expenses = !empty($this->reportData['expenses']) ? $this->reportData['expenses'] : 0;
$note = $this->reportData['note'] ?? 0;

$exportStockTotalAmountByDate = $this->exportStockTotalAmountByDate ?? [];
$vetCareTotalAmountByDate = $this->vetCareTotalAmountByDate ?? [];
$expensesTotalAmountByDate = $this->expensesTotalAmountByDate ?? [];
?>
<div class="row mt-5">
    <h1> Thêm báo cáo thu - chi </h1>
    <form method="post" action="/report/do-edit">
            <input type="hidden" name="id" value="<?= $id ?>">
            <input type="hidden" id="exportStockTotalAmountByDate" value='<?= json_encode($exportStockTotalAmountByDate) ?>'>
            <input type="hidden" id="vetCareTotalAmountByDate" value='<?= json_encode($vetCareTotalAmountByDate) ?>'>
            <input type="hidden" id="expensesTotalAmountByDate" value='<?= json_encode($expensesTotalAmountByDate) ?>'>
        <div class="mb-3">
            <label class="form-label">Ngày</label>
            <input type="text" class="form-control date-picker" id="date" name="date" autocomplete="off" required onchange="reloadReportByDate()" value="<?= $date ?>">
        </div>
        <div class="mb-3">
            <label class="form-label">Thu</label>
            <div class="input-group">
                <span class="input-group-text">VNĐ</span>
                <input type="text" class="form-control" id="revenue" name="revenue" required value="<?= $revenue ?>">
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">Chi</label>
            <div class="input-group">
                <span class="input-group-text">VNĐ</span>
                <input type="text" class="form-control" id="expenses" name="expenses" required value="<?= $expenses ?>">
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">Còn lại</label>
            <div class="input-group">
                <span class="input-group-text">VNĐ</span>
                <input style="background: silver" type="text" class="form-control" id="remaining" required value="<?= $revenue - $expenses ?>">
            </div>
        </div>
        <div class="mb-3">
            <label class="form-label">Ghi chú</label>
            <textarea class="form-control" name="note"><?= $note ?></textarea>
        </div>
        <div class="mb-3">
            <button type="submit" class="btn btn-primary float-end">Lưu</button>
            <a href="/report" class="btn btn-danger float-end mx-2">Quay lại</a>
        </div>
    </form>
</div>

<script>
    let exportStockTotalAmountByDate = [];
    let vetCareTotalAmountByDate = [];
    let expensesTotalAmountByDate = [];

    $(document).ready(function() {
        $('.date-picker').datepicker({
            format: 'dd/mm/yyyy',
            autoclose:true
        });

        initVariable()
    });

    function initVariable() {
        exportStockTotalAmountByDate = JSON.parse($('#exportStockTotalAmountByDate').val() ?? '{}');
        vetCareTotalAmountByDate = JSON.parse($('#vetCareTotalAmountByDate').val() ?? '{}');
        expensesTotalAmountByDate = JSON.parse($('#expensesTotalAmountByDate').val() ?? '{}');
    }

    function reloadReportByDate() {
        const date = $('#date').val();
debugger
        const exportStock = exportStockTotalAmountByDate[date] ?? 0;
        const vetCare = vetCareTotalAmountByDate[date] ?? 0;
        const revenue = exportStock + vetCare;

        const expenses = expensesTotalAmountByDate[date] ?? 0;

        $('#revenue').val(revenue);
        $('#expenses').val(expenses);
        $('#remaining').val(revenue - expenses);
    }
</script>